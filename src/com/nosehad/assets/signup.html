<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/images/bulma.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <meta charset="UTF-8">
  <title>NVPN - Signup</title>
</head>
<body>
<div id="signup" class="container" style="padding-top: 7%; padding-left: 5%; padding-right: 5%;">
  <h2 class="title is-2" style="padding-top: 2%;">Sign Up for <strong style="
    background-image: linear-gradient(45deg, #a344a6, #4b4bd0);
   -webkit-background-clip: text;
   -webkit-text-fill-color: transparent;
   -moz-background-clip: text;
   -moz-text-fill-color: transparent;">Free</strong></h2>
  <form class="box" style="padding-top: 2%;">
    <div class="field">
      <label class="label">Email</label>
      <div class="control">
        <input id="email" class="input" type="email" placeholder="e.g. contact@nosehad.com">
      </div>
    </div>

    <div class="field">
      <label class="label">Password</label>
      <div class="control">
        <input id="passwd1" class="input" type="password" placeholder="********">
      </div>
    </div>
    <div class="field">
      <label class="label">Confirm Password</label>
      <div class="control">
        <input id="passwd2" class="input" type="password" placeholder="********">
      </div>
    </div>
    <label class="checkbox" style="padding-bottom: 2.1%; user-select: none;">
      <input type="checkbox" id="accept" >
      I agree to the <a href="/tac">terms and conditions</a>
    </label>
    <div class="columns">
      <div class="column is-one-fifth">
        <a id="create" class="button" style="  
        background-image: linear-gradient(45deg, #a344a6, #4b4bd0);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       -moz-background-clip: text;
       -moz-text-fill-color: transparent;"><strong>Signup</strong></a>
      </div>
      <div class="column is-one-fifth">
      <div id="res" style="padding-top: 4%;">
        
      </div>
      </div>
    </div>
  </form>
  <div id="banned" class="container", style="text-align: left;"></div>
</div>
<script type="text/javascript">
  function clear_bnd() {
    document.getElementById('banned').innerHTML = ''
  } 

  document.getElementById('create').addEventListener('click', function () {
    if(document.getElementById("passwd1").value != document.getElementById("passwd2").value) {
      document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-light\" style=\"padding-top: 1%; text-align: left;\">Passwords don't match.</span>";
    }
    else if(document.getElementById("email").value.includes('/')) { // i have to do this here, otherwise it could result in html errors
      document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-light\" style=\"padding-top: 1%; text-align: left;\">Email is invalid.</span>";
    }
    else if(!document.getElementById('accept').checked) {
      document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-light\" style=\"padding-top: 1%; text-align: left;\">You have to agree to our terms and conditions.</span>";
    }
    else if(!(document.getElementById('email').value.includes('/') || document.getElementById('passwd1').value.includes('/') || document.getElementById('passwd2').value.includes('/'))) {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open( "GET", "/l/create=" + document.getElementById("email").value + "&&" + document.getElementById("passwd1").value, false ); 
      xmlHttp.send( null );
      if(xmlHttp.responseText == 'failure') {
        document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-light\" style=\"padding-top: 1%; text-align: left;\">User with this email already exists.</span>";
      }
      else if(xmlHttp.responseText == 'alr') {
        document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-success\" style=\"padding-top: 1%; text-align: left;\">You are already logged in to an account.</span>";
      }
      else if(xmlHttp.responseText == 'email') {
        document.getElementById('res').innerHTML = "<span class=\"tag is-danger is-light\" style=\"padding-top: 1%; text-align: left;\">Email is invalid.</span>";
      }
      else if(xmlHttp.responseText == 'banned') {
          document.getElementById('banned').innerHTML = '        <article class="message is-danger">\
  <div class="message-header">\
    <p>Security Ban.</p>\
    <button class="delete" aria-label="delete" onclick="clear_bnd()"></button>\
  </div>\
  <div class="message-body">\
    Our Bot protection has permanently banned your ip from this platform.<br>\
    Please contact contact@nosehad.com if you believe, this is an error.\
  </div>\
</article>';
        }
      else if (xmlHttp.responseText == 'done') {
        window.location.replace("/home");
        }
    }
  })
</script>
</body>
</html>